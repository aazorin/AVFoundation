# Playing Video
비디오는 정보를 제공하고 영향을 미치며, 교육을 받고 즐겁게 하기위한 매우 강력한 매체입니다. YouTube 및 Vimeo와 같은 비디오 공유 사이트 덕분에 지난 10년 동안 비디오를 소비하는 방식이 크게 바뀌 었습니다. 최근에는 iPhone 및 iPad와 같은 장치 덕분입니다. 텔레비전은 스트리밍 비디오로 빠르게 빼앗겨 가고 있습니다. 온라인 교육 및 비디오 기반의 가상 교실이 점점 보편화되고 있으며 페이스 북 및 트위터와 같은 사이트에서 매 순간 분주하게 많은 비디오가 공유됩니다. 분명히 증가하는 수요를 충족시키기 위해 풍부하고 역동적인 비디오 경험을 개발해야 할 필요가 있습니다. 이 장에서는 AV Foundation의 비디오 재생 기능에 대해 자세히 설명합니다. 맞춤 동영상 플레이어 제작과 관련된 핵심 구성 요소에 대해 논의하고 프레임 워크가 제공하는 추가 기능을 살펴보고 재생 환경을 더욱 향상시킵니다.

## Playback Overview
커스텀 플레이어를 개발할 때 많은 오브젝트가 관련됩니다. 이 섹션에서는 관련 클래스의 역할과 관계를 탐구하여 AV Foundation의 재생 기능에 대해 상당히 높은 수준의 소개부터 시작하겠습니다. 다음 섹션에서는 API 세부 정보를 자세히 살펴보고 맞춤 동영상 플레이어를 개발하여 이러한 클래스를 실제로 적용 해 보겠습니다. 그림 4.1은 관련 클래스와 그 관계에 대한 개요를 제공합니다.

<center>
<image src="Resource/01.png" width="30%" height="30%">
</center>

### AVPlayer
AV Foundation의 재생 지원은 `AVPlayer`라는 클래스를 중심으로 이루어집니다. AVPlayer는 시간이 지정된 오디오 - 비주얼 미디어를 재생하는데 사용되는 컨트롤러 개체입니다. `HTTP 라이브 스트리밍 프로토콜`을 통해 전달되는 로컬, 점진적으로 다운로드 또는 스트리밍된 미디어의 재생을 지원하므로 다양한 재생 시나리오에서 유용합니다. 나는 "컨트롤러"라고 할 때 일반적인 의미에서 의미한다는 것을 분명히해야한다. 뷰 또는 윈도우 컨트롤러가 아니지만 관련 Asset의 재생 및 타이밍을 관리하는 객체입니다. Timed Media의 재생을 제어하기 위해 사용자 인터페이스를 개발하는 데 사용할 프로그래밍 방식의 인터페이스를 제공합니다.
AVPlayer는 `비시각적 구성 요소`입니다. MP3 또는 AAC 오디오 파일을 재생하는 것이 목표인 경우 사용자 인터페이스가 부족해도 문제가 발생하지 않습니다. 그러나 이 경우 QuickTime 동영상 또는 MPEG-4 비디오를 재생하는 것이 목표라면 다소 실망스러운 사용자 경험이 될 것입니다. 비디오 출력을 사용자 인터페이스의 대상으로 지정하려면 `AVPlayerLayer`라는 클래스를 사용합니다.

```
노트
AVPlayer는 단일 자산의 재생을 관리하지만 프레임 워크는 자산 대기열을 관리 할 수있는 AVQueuePlayer라는 AVPlayer의 하위 클래스도 제공합니다. 이 클래스는 여러 항목을 순서대로 재생하거나 오디오 또는 비디오 에셋의 끝없는 반복을 설정하려는 경우에 유용합니다.
```

### AVPlayerLayer
`AVPlayerLayer는 Core Animation 위에 구축`되며 AV Foundation에서 찾을 수있는 몇 가지 비주얼 구성 요소 중 하나입니다. Core Animation은 Mac 및 iOS에서 사용할 수 있는 그래픽 렌더링 및 애니메이션 프레임 워크이며 이러한 플랫폼에서 볼 수있는 아름답고 유동적인 애니메이션을 담당합니다. Core Animation은 `본질적으로 시간 기반`이며, `OpenGL을 기반으로 제작` 되었기 때문에 놀랄만큼 성능이 뛰어나서 AV Foundation의 요구에 완벽하게 부합합니다.
AVPlayerLayer는 `Core Animation의 CALayer 클래스를 확장`하고 프레임 워크에서 비디오 내용을 화면에 렌더링하는데 사용됩니다. 이 레이어는 시각적 컨트롤이나 다른 장식물(사용자가 직접 작성해야 함)을 제공하지 않지만 비디오 내용의 렌더링 표면 역할을합니다. `AVPlayerLayer는 AVPlayer 인스턴스에 대한 포인터`로 생성됩니다. 이렇게하면 레이어를 플레이어에 강력하게 바인딩하여 플레이어의 시간 기반 메서드에 대한 변경 사항이 발생하면 동기화를 유지할 수 있습니다. AVPlayerLayer는 다른 CALayer처럼 사용할 수 있으며 UIView 또는 NSView의 백업 레이어로 설정하거나 기존 레이어 계층에 수동으로 추가 할 수 있습니다.
AVPlayerLayer는 상당히 단순한 클래스이며 일반적으로 그대로 사용됩니다. 사용자 정의 할 수 있는 레이어의 한 측면은 `비디오 중력`입니다. VideoGravity 속성에 대해 지정 할 수 있는 세 가지 중력 값이 있어 비디오를 포함하는 레이어의 경계 내에서 비디오를 늘리거나 크기를 조정하는 방법을 결정합니다. 그림 4.2, 4.3 및 4.4는 다양한 중력 값의 효과를 볼 수 있도록 4 : 3 경계 사각형 내에 16 : 9 비디오를 표시하는 것을 보여줍니다.

<center>
<image src="Resource/02.png" width="30%" height="30%">
</center>

<center>
<image src="Resource/03.png" width="30%" height="30%">
</center>

<center>
<image src="Resource/04.png" width="30%" height="30%">
</center>

### AVPlayerItem
궁극적인 목표는 AVPlayer를 사용하여 AVAsset을 재생하는 것입니다. AVAsset에 대한 설명서를 보면 제작 날짜, 메타 데이터 및 기간과 같이 데이터를 검색 할 수 있는 메서드와 속성을 찾을 수 있습니다. 그러나 볼 수 없는 것은 현재 시간이나 미디어 내의 특정 위치를 찾는 기능을 검색하는 방법입니다. AVAsset은 미디어 리소스의 정적 측면만 모델링하기 때문입니다. 객체의 정적 상태를 나타내는 영구 속성. 즉, 자체적으로 `AVAsset은 재생에 전혀 적합하지 않습니다`. 저작물과 관련 트랙을 재생하려면 먼저 AVPlayerItem 및 AVPlayerItemTrack 클래스에서 제공하는 `동적 요소를 구성`해야합니다.
AVPlayerItem은 미디어의 동적 관점을 모델링하고 AVPlayer가 재생하는 자산의 표현 상태를 전달합니다. 이 클래스에서 seekToTime : 및 currentTime 및 presentationSize에 액세스하기위한 속성 등의 메서드를 찾을 수 있습니다. AVPlayerItem은 하나 이상의 미디어 트랙으로 구성되며 AVPlayerItemTrack 클래스로 모델링됩니다. AVPlayerItemTrack의 인스턴스는 오디오 및 비디오와 같이 플레이어 항목에 포함된 균등하게 입력된 미디어 스트림을 나타냅니다. AVPlayerItem에 있는 트랙은 기본 AVAsset에 있는 AVAssetTrack 인스턴스에 직접 해당합니다.

### Playback Recipe
이러한 클래스를 간단히 이해할 수 있도록 애플리케이션 스택에 포함된 비디오를 재생하기 위해 재생 스택을 설정하는 방법에 대한 간단한 코드 예제를 살펴 보겠습니다.